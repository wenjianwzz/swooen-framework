# Swooen框架

受Lumen启发，基于Symfony、Swoole的一个自研框架。

- 面向接口优化，对于页面渲染没有特殊优化，但可以支持
- 容器化
- FPM下可运行HTTP服务
- 支持WebSocket
- 未来可扩展gRPC、TCP等协议
- 无论请求来自何种协议，都应当封装成统一的Package
- 对于持久连接，如WebSocket，请求帧会被封装成Package
- 容器分级别，请求上下文、连接、进程
- 抽象HTTP和WebSocket
- 分Module，Module可以独立运行，也可以在总包中运行

## 分层
处理链（链式处理函数，每个节点可以向下传递数据，存取连接数据，中断处理链，返回并渲染数据包）
路由（选择合适的处理链，调用处理链）
连接（维护会话信息，向路由传递包，和输出渲染器）
输入输出（读取数据包，创建连接，将数据包发送到连接队列）
运行环境（启动，将模块初始化）

？会话层从属协议么，谁定义和维护会话的协议，如SessionID、持久连接方案两者共存的时候如何抉择
？多个接待员并存的时候，路由如何选择

## 组成
### 包
系统交互的基本组成单位
### 输入输出
负责和外部交互的部分，输入负责读取并生成包，输出负责将包渲染成预先配置的格式。输入输出是成对出现的。
### 会话
同一个对端的一批包可以从属于一个会话，会话的信息在包之间是共享的，持久的。
### 启动器
负责处理运行环境差异，组装并启动输入输出系统.

### 路由

### 处理链

### 接待员

# 连接
- 作为容器存储连接相关的数据
- 组织读写器

# 容器
## App 进程级别
负责初始化工厂类、上下文Hook等
公用的，进程安全的类也可以放在此处

## 连接
存储连接相关的数据

## 处理器上下文
初始化HandlerHook、Handler，注入Handler依赖等

## 数据包
数据包元素分为

- 输入 主要数据
- 元数据 辅助数据
- 追踪数据 追踪对端信息的数据

### HTTP协议处理成数据包
- Body和Query合并成输入
- Header映射为元数据
- Cookie 映射为追踪数据

### WebSocket
- 数据帧和Query合并为成输入
- Header映射为元数据
- Cookie 映射为追踪数据

### 数据包的路由
#### 可路由数据包
将会被路由到指定处理器

#### 不可路由数据包
会指定路由到`<NOT_ROUTEABLE>`对应的处理器

##
1. Server 创建Connection
2. Connection 获取 客户端输入，得到Package
3. 路由分发Package，调用控制器
4. 控制器返回Package
5. 回写Package

### 是控制器直接回发，还是由外层调度回发
外层调度回发

## 版权申明
- Swooen\Utils下一些代码拷贝自illuminate/support和illuminate/config，不完全引入是因为有冲突